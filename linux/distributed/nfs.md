# Network File System(NFS) 网络文件系统

是由SUN公司研制的UNIX表示层协议(presentation layer protocol)  

​NFS服务器可以让PC将网络中的NFS服务器共享的目录挂载到本地端的文件系统中，而在本地端的系统中来看，那个远程主机的目录就好像是自己的一个磁盘分区一样，在使用上相当便利

NFS 允许在多个用户之间共享公共文件系统，并提供数据集中的优势，来最小化所需的存储空间, 已成为分布式文件系统的基础。

虽然 NFS 是在 UNIX和 Linux 系统中最流行的网络文件系统，但它当然不是唯一的选择。  
在 Windows系统中，`Server Message Block [SMB]`（也称为 CIFS）是最广泛使用的选项（如同 Linux 支持 SMB一样，Windows 也支持 NFS）。  

`Ceph` 是最新的分布式文件系统之一,在 Linux 中也支持,其他例子包括 `OpenAFS,GlusterFS,Lustre`.  


NFS是基于UDP/IP协议的应用，其实现主要是采用远程过程调用RPC机制,  
用RPC来统一管理NFS端口的服务,RPC采用了XDR的支持.  

## Remote Procedure Call(RPC) 远程过程调用

RPC提供了一组与机器、操作系统以及低层传送协议无关的存取远程文件的操作。

1. 进程间通信（IPC）是在多任务操作系统或联网的计算机之间运行的程序和进程所用的通信技术.
2. 本地过程调用(LPC)LPC用在多任务操作系统中，使得同时运行的任务能互相会话。这些任务共享内存空间使任务同步和互相发送信息。
3. 远程过程调用（RPC)RPC类似于LPC，只是在网上工作。RPC开始是出现在Sun微系统公司和HP公司的运行UNⅨ操作系统的计算机中。


XDR是一种与机器无关的数据描述编码的协议，他以独立与任意机器体系结构的格式对网上传送的数据进行编码和解码，支持在异构系统之间数据的传送。

# NFS 配置概述

## rpcbind - RPC 主程序 

NFS 其实可以被视为一个 RPC 服务  
1. 启动任何一个 RPC 服务之前，我们都需要做好 port 的对应 (mapping) 的工作才行
2. 这个工作其实就是 `rpcbind` 这个服务所负责的,即在启动任何一个 RPC 服务之前都需要启动 rpcbind 才行
3. 在 CentOS 5.x 以前这个软件称为 portmap, 在 CentOS 6.x 之后才称为 rpcbind 

## nfs-utils - NFS 主程序 

* 主要配置文件  
  * `/etc/exports`  
  * 文件是空白的，有的系统可能不存在这个文件，主要手动建立。
* NFS文件系统维护指令
  * `/usr/sbin/exportfs`
  * 维护 NFS 分享资源的指令，可以利用这个指令重新分享 /etc/exports 变更的目录资源、将 NFS Server 分享的目录卸除或重新分享
* 分享资源的登录档
  * `/var/lib/nfs/*tab`  *代表某一个字符
  * NFS 服务器的登录文件都放置到该目录里面
  * 该目录下有两个比较重要的登录档
    * etab ，主要记录了 NFS 所分享出来的目录的完整权限设定值
    * 另一个 xtab 则记录曾经链接到此 NFS 服务器的相关客户端数据。
* 客户端查询服务器分享资源
  * `/usr/sbin/showmount`
  * showmount 可以用来察看 NFS 分享出来的目录资源。

## autofs - 客户端服务  

(`/etc/rc.d/rc.local`文件中写入的命令, 在每次启动系统用户登录之前都会执行一次)  

* 在一般NFS文件系统的使用过程中，如果客户端要使用服务端所提供的文件系统  
  * 可以在`/etc/rc.d/rc.local`中设置开机时自动挂载  
  * 也可以在登录系统后手动利用mount来挂载  
* 由于网络的问题,NFS服务器与客户端的连接不会一直存在,当我们挂载了NFS服务器之后,任何一方脱机都可能造成另外一方等待超时

因此就有了autofs
1. 持续的检测某个指定的目录
2. 预先设置当使用到该目录的某个子目录时,将会取得来自服务器端的NFS文件系统资源,并进行自动挂载的操作

